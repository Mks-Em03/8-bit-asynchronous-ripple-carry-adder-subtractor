<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>8-bit Ripple-Carry Adder/Subtractor — Animated</title>
<style>
  :root { --fa: 72px; --gap: 20px; --speed: 0.9s; font-family: Inter, system-ui, sans-serif; }
  body { margin: 24px; color: #111; background: #fff; }
  h1 { font-size: 22px; margin: 0 0 6px; }
  .sub { color:#555; margin-bottom: 18px; }
  .row { display: grid; grid-template-columns: repeat(8, var(--fa)); gap: var(--gap); align-items: center; }
  .stage { position: relative; height: var(--fa); border-radius: 14px; box-shadow: 0 1px 6px rgba(0,0,0,.12); }
  .stage.add { background: #f2f9ff; }
  .stage.sub { background: #fff5f2; }
  .bitlabel { position:absolute; top:-18px; left:6px; font: 12px/1.2 monospace; color:#666; }
  .pins { position:absolute; inset: 6px; display:grid; grid-template-rows: 1fr auto; }
  .io { display:flex; justify-content: space-between; font: 12px monospace; color:#333; }
  .carry { position:absolute; top: calc(50% - 4px); left: -12px; width: calc(100% + 24px); height: 8px; }
  .carry .bubble { position:absolute; top:0; width:8px; height:8px; border-radius:50%; background:#111; opacity:.12; }
  .carry.propagate .bubble { animation: move var(--speed) linear forwards; }
  .carry.blocked .bubble { opacity:.08; }
  @keyframes move {
    from { transform: translateX(0); opacity:.22; }
    to   { transform: translateX(calc(100% - 8px)); opacity:.85; }
  }
  .controls { display:flex; gap:12px; align-items:center; margin: 20px 0 10px; }
  button, input[type="number"], .toggle { font: 14px/1.1 system-ui; padding:8px 12px; border:1px solid #ddd; border-radius:10px; background:#fff; }
  button { cursor:pointer; }
  .toggle { display:inline-flex; gap:8px; align-items:center; cursor:pointer; }
  .toggle input { accent-color:#111; }
  .legend { font:12px monospace; color:#444; margin-top:10px; }
  .footer { margin-top:18px; font:12px; color:#666; }
</style>
</head>
<body>
  <h1>8-bit Ripple-Carry Adder/Subtractor</h1>
  <div class="sub">Visualize <b>carry propagation</b> across full-adder stages. Toggle add/sub, edit A and B, and watch the ripple.</div>

  <div class="controls">
    <label class="toggle"><input id="mode" type="checkbox" /> SUB (A − B)</label>
    <label>A: <input id="aval" type="number" min="0" max="255" value="173" /></label>
    <label>B: <input id="bval" type="number" min="0" max="255" value="87" /></label>
    <button id="run">Run</button>
    <span id="sum" style="margin-left:8px;font:14px monospace;"></span>
    <span id="flags" style="margin-left:8px;font:12px monospace;color:#444;"></span>
  </div>

  <div class="row" id="row"></div>
  <div class="legend">Legend: dark bubble = carry propagating; light bubble = blocked; SUB uses B⊕1 and Cin=1.</div>
  <div class="footer">Tip: try A=255, B=1 (ADD) and A=128, B=1 (SUB) to see overflow behavior.</div>

<script>
const N = 8;
const row = document.getElementById('row');
const modeEl = document.getElementById('mode');
const avalEl = document.getElementById('aval');
const bvalEl = document.getElementById('bval');
const runBtn = document.getElementById('run');
const sumEl = document.getElementById('sum');
const flagsEl = document.getElementById('flags');

function bit(v,i){ return (v>>i)&1; }

function stageEl(i){
  const s = document.createElement('div');
  s.className = 'stage add';
  s.innerHTML = `
    <div class="bitlabel">FA[${i}]</div>
    <div class="pins">
      <div class="io"><span>A${i}=</span><span class="a"></span></div>
      <div class="io"><span>B${i}=</span><span class="b"></span></div>
      <div class="io"><span>Ci=</span><span class="ci"></span></div>
      <div class="io"><span>S${i}=</span><span class="s"></span></div>
      <div class="io"><span>Co=</span><span class="co"></span></div>
    </div>
    <div class="carry"><div class="bubble"></div></div>
  `;
  return s;
}

for(let i=0;i<N;i++) row.appendChild(stageEl(i));

function run(){
  const A = Number(avalEl.value)|0;
  const B = Number(bvalEl.value)|0;
  const sub = modeEl.checked;
  const bIn = sub ? (~B)&0xFF : B;
  let cin = sub ? 1 : 0;
  let sum = 0;

  [...row.children].forEach((s,i)=>{
    s.className = 'stage ' + (sub?'sub':'add');
    s.querySelector('.a').textContent = bit(A,i);
    s.querySelector('.b').textContent = bit(bIn,i) + (sub?' (⊕1)':'');
    s.querySelector('.ci').textContent = cin;

    const ai = bit(A,i), bi = bit(bIn,i);
    const si = ai ^ bi ^ cin;
    const g = ai & bi;
    const p = ai ^ bi;
    const co = g | (p & cin);

    s.querySelector('.s').textContent = si;
    s.querySelector('.co').textContent = co;

    sum |= (si<<i);

    // animate carry bubble
    const c = s.querySelector('.carry');
    c.className = 'carry ' + (p? 'propagate':'blocked');
    const bub = c.querySelector('.bubble');
    bub.style.animation = 'none';
    void bub.offsetWidth; // reflow
    bub.style.animation = '';

    cin = co;
  });

  let cout = cin;
  // signed overflow detection (two's complement)
  const msbA = (A>>7)&1, msbB = ((sub?((~B)&0xFF):B)>>7)&1, msbS = (sum>>7)&1;
  const overflow = (msbA ^ msbS) & (msbB ^ msbS);

  sumEl.textContent = `Result = ${sum & 0xFF} (0x${(sum&0xFF).toString(16).padStart(2,'0')}) Cout=${cout}`;
  flagsEl.textContent = ` | OF=${overflow}  mode=${sub?'SUB':'ADD'}`;
}

runBtn.onclick = run;
run();
</script>
</body>
</html>
